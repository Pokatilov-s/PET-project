{% extends 'front/navbar.html' %}
{% block title %}Регистрация и Авторизация{% endblock %}

{% block content %}
<!--<body>-->
<!--<div class="container mt-5">-->
<!--    <h2 class="text-center">Регистрация</h2>-->
<!--    <form id="registration-form">-->
<!--        <div class="form-group">-->
<!--            <label for="username">Имя пользователя</label>-->
<!--            <input type="text" class="form-control" id="username" placeholder="Введите имя пользователя" required>-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="email">Электронная почта</label>-->
<!--            <input type="email" class="form-control" id="email" placeholder="Введите электронную почту" required>-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="password">Пароль</label>-->
<!--            <input type="password" class="form-control" id="password" placeholder="Введите пароль" required>-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="password2">Повторите пароль</label>-->
<!--            <input type="password" class="form-control" id="password2" placeholder="Повторите пароль" required>-->
<!--        </div>-->
<!--        <button type="submit" class="btn btn-primary btn-block">Зарегистрироваться</button>-->
<!--    </form>-->

<!--    <h2 class="text-center mt-5">Авторизация</h2>-->
<!--    <form id="login-form">-->
<!--        <div class="form-group">-->
<!--            <label for="login-username">Имя пользователя</label>-->
<!--            <input type="text" class="form-control" id="login-username" placeholder="Введите имя пользователя" required>-->
<!--        </div>-->
<!--        <div class="form-group">-->
<!--            <label for="login-password">Пароль</label>-->
<!--            <input type="password" class="form-control" id="login-password" placeholder="Введите пароль" required>-->
<!--        </div>-->
<!--        <button type="submit" class="btn btn-primary btn-block">Войти</button>-->
<!--    </form>-->
<!--</div>-->

<!--<script>-->
<!--    $(document).ready(function() {-->
<!--        $('#registration-form').submit(function(event) {-->
<!--            event.preventDefault();-->
<!--            $.ajax({-->
<!--                url: '/auth/users/',-->
<!--                type: 'POST',-->
<!--                contentType: 'application/json',-->
<!--                data: JSON.stringify({-->
<!--                    username: $('#username').val(),-->
<!--                    email: $('#email').val(),-->
<!--                    password: $('#password').val(),-->
<!--                    re_password: $('#password2').val()-->
<!--                }),-->
<!--                success: function(response) {-->
<!--                    alert('Регистрация успешна!');-->
<!--                },-->
<!--                error: function(response) {-->
<!--                    alert('Ошибка при регистрации: ' + JSON.stringify(response.responseJSON));-->
<!--                }-->
<!--            });-->
<!--        });-->

<!--        $('#login-form').submit(function(event) {-->
<!--            event.preventDefault();-->
<!--            $.ajax({-->
<!--                url: '/auth/token/login/',-->
<!--                type: 'POST',-->
<!--                contentType: 'application/json',-->
<!--                data: JSON.stringify({-->
<!--                    username: $('#login-username').val(),-->
<!--                    password: $('#login-password').val()-->
<!--                }),-->
<!--                success: function(response) {-->
<!--                    localStorage.setItem('notCoursesPrefix_authToken', response.auth_token);-->
<!--                    alert('Авторизация успешна!');-->
<!--                },-->
<!--                error: function(response) {-->
<!--                    alert('Ошибка при авторизации: ' + JSON.stringify(response.responseJSON));-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    });-->
<!--</script>-->
<!--</body>-->

<div class="container mt-5">
    <!-- Вкладки для регистрации и авторизации -->
    <ul class="nav nav-tabs" id="authTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link" id="registration-tab" data-toggle="tab" href="#registration" role="tab" aria-controls="registration" aria-selected="false">Регистрация</a>
        </li>
        <li class="nav-item">
            <a class="nav-link active" id="login-tab" data-toggle="tab" href="#login" role="tab" aria-controls="login" aria-selected="true">Авторизация</a>
        </li>
    </ul>

    <!-- Содержимое вкладок -->
    <div class="tab-content" id="authTabsContent">
        <!-- Вкладка регистрации -->
        <div class="tab-pane fade" id="registration" role="tabpanel" aria-labelledby="registration-tab">
            <h2 class="text-center">Регистрация</h2>
            <form id="registration-form">
                <!-- Форма регистрации -->
                <div class="form-group">
                    <label for="username">Имя пользователя</label>
                    <input type="text" class="form-control" id="username" placeholder="Введите имя пользователя" required>
                </div>
                <div class="form-group">
                    <label for="email">Электронная почта</label>
                    <input type="email" class="form-control" id="email" placeholder="Введите электронную почту" required>
                </div>
                <div class="form-group">
                    <label for="password">Пароль</label>
                    <input type="password" class="form-control" id="password" placeholder="Введите пароль" required>
                </div>
                <div class="form-group">
                    <label for="password2">Повторите пароль</label>
                    <input type="password" class="form-control" id="password2" placeholder="Повторите пароль" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Зарегистрироваться</button>
            </form>
        </div>

        <!-- Вкладка авторизации -->
        <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
            <h2 class="text-center mt-5">Авторизация</h2>
            <form id="login-form">
                <!-- Форма авторизации -->
                <div class="form-group">
                    <label for="login-username">Имя пользователя</label>
                    <input type="text" class="form-control" id="login-username" placeholder="Введите имя пользователя" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Пароль</label>
                    <input type="password" class="form-control" id="login-password" placeholder="Введите пароль" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">Войти</button>
            </form>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        // Обработчик клика на вкладку
        $('#authTabs a').on('click', function (e) {
            e.preventDefault()
            $(this).tab('show')
        });

        // Обработчик события изменения вкладки
        $('#authTabs a').on('shown.bs.tab', function (e) {
            var target = $(e.target).attr("href") // Активная вкладка
            localStorage.setItem('regNotCoursesActiveTab', target); // Сохранение активной вкладки в localStorage
        });

        // Получение активной вкладки из localStorage и открытие её
        var regNotCoursesActiveTab = localStorage.getItem('regNotCoursesActiveTab');
        if(regNotCoursesActiveTab){
            $('#authTabs a[href="' + regNotCoursesActiveTab + '"]').tab('show');
        }
    });
</script>
<script>
    $(document).ready(function() {
        $('#registration-form').submit(function(event) {
            event.preventDefault();
            $.ajax({
                url: '/auth/users/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    username: $('#username').val(),
                    email: $('#email').val(),
                    password: $('#password').val(),
                    re_password: $('#password2').val()
                }),
                success: function(response) {
                    alert('Регистрация успешна!');
                    $('#authTabs a[href="#login"]').tab('show'); // Переключаемся на вкладку авторизации
                    localStorage.setItem('regNotCoursesActiveTab', '#login');
                },
                error: function(response) {
                    alert('Ошибка при регистрации: ' + JSON.stringify(response.responseJSON));
                }
            });
        });

        $('#login-form').submit(function(event) {
            event.preventDefault();
            $.ajax({
                url: '/auth/token/login/',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    username: $('#login-username').val(),
                    password: $('#login-password').val()
                }),
                success: function(response) {
                    localStorage.setItem('notCoursesPrefix_authToken', response.auth_token);
                    alert('Авторизация успешна!');
                    window.location.href = '/';
                },
                error: function(response) {
                    alert('Ошибка при авторизации: ' + JSON.stringify(response.responseJSON));
                }
            });
        });
    });
</script>
<!--<script>-->
<!--    $(document).ready(function() {-->
<!--        $('#registration-form').submit(function(event) {-->
<!--        });-->

<!--        $('#login-form').submit(function(event) {-->
<!--            event.preventDefault();-->
<!--            $.ajax({-->
<!--                url: '/auth/token/login/',-->
<!--                type: 'POST',-->
<!--                contentType: 'application/json',-->
<!--                data: JSON.stringify({-->
<!--                    username: $('#login-username').val(),-->
<!--                    password: $('#login-password').val()-->
<!--                }),-->
<!--                success: function(response) {-->
<!--                    localStorage.setItem('notCoursesPrefix_authToken', response.auth_token);-->
<!--                    window.location.href = '/';-->
<!--                },-->
<!--                error: function(response) {-->
<!--                    alert('Ошибка при авторизации: ' + JSON.stringify(response.responseJSON));-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    });-->
<!--</script>-->

{% endblock %}